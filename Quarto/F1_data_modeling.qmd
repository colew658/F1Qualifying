---
title: "F1 Project Data Modeling"
author: "Cole Wagner"
format:
  html:
    toc: true
    self-contained: true
    code-fold: true
    code-line-numbers: true
    code-tools: true
    cache: true
    theme: "yeti"
editor: visual
---

```{r setup}
library(tidyverse)
library(tidymodels)
library(janitor)

full_no_missing <- read_csv("../Data/full_no_missing.csv")

full_clean_types <- full_no_missing %>%
  # Automatic conversion
  type_convert() %>%
  # Convert some numeric variables to factors
  mutate(
    MEETING_KEY = as.factor(MEETING_KEY),
    SESSION_KEY = as.factor(SESSION_KEY),
    DRIVER_NUMBER = as.factor(DRIVER_NUMBER),
    RAINFALL = as.factor(RAINFALL)
  )
```

# Engineering the Outcome

The outcome variable is the difference between the actual lap time and the average lap time (given the track).

```{r OutcomeEngineer}
# Find the average lap time for each track
avg_time_summary <- full_clean_types %>%
  group_by(CIRCUIT_SHORT_NAME) %>%
  summarise(
    AVG_LAP_DURATION = mean(LAP_DURATION)
  ) %>%
  ungroup()

# Create the outcome TIME_DIFF
modeling_data <- left_join(full_clean_types, avg_time_summary) %>%
  mutate(TIME_DIFF = LAP_DURATION - AVG_LAP_DURATION) %>%
  # Keep only the variables needed for modeling
  select(c(13:19, 23, 33:34, 36))
  
```








